# V1 上线任务清单

> 生成日期：2026-02-08
> 状态：V1 功能开发完成（354 个单元测试通过），进入上线准备阶段

## 优先级说明

- **P0 — 必须完成**：不做就无法运行
- **P1 — 强烈建议**：影响可用性和正确性
- **P2 — 锦上添花**：提升体验但不阻塞使用
- **V2 — 后续版本**：明确不在当前阶段

---

## Phase 1: 环境搭建与数据准备 [P0]

> **建议最先做这个。** 没有数据，前后端都跑不起来。

- [ ] 1.1 配置 `.env` 文件（数据库、Redis、Gemini API Key）
- [ ] 1.2 启动 PostgreSQL，创建 `stock_selector` 数据库
- [ ] 1.3 执行 `uv run alembic upgrade head` 创建 12 张表
- [ ] 1.4 启动 Redis 服务
- [ ] 1.5 执行 `uv run python -m app.data.cli sync-stocks` 导入股票列表
- [ ] 1.6 执行 `uv run python -m app.data.cli sync-daily --start 2024-01-01 --end 2026-02-08` 导入日线行情
- [ ] 1.7 执行 `uv run python -m app.data.cli calc-indicators --start 2024-01-01 --end 2026-02-08` 计算技术指标
- [ ] 1.8 验证数据完整性（抽查几只股票的日线和指标数据）

## Phase 2: 服务启动与冒烟测试 [P0]

> 确认前后端能正常启动和通信。

- [ ] 2.1 启动后端：`uv run uvicorn app.main:app --reload`
- [ ] 2.2 访问 http://localhost:8000/docs 确认 Swagger 文档正常
- [ ] 2.3 手动调用 `GET /api/v1/strategy/list` 确认返回 12 种策略
- [ ] 2.4 手动调用 `GET /api/v1/data/kline/600519.SH` 确认 K 线数据
- [ ] 2.5 安装前端依赖：`cd web && pnpm install`
- [ ] 2.6 启动前端：`pnpm dev`
- [ ] 2.7 访问 http://localhost:5173 确认页面加载正常
- [ ] 2.8 确认前端 API 代理到后端正常工作

## Phase 3: 业务流程验收 [P1]

> 走通核心业务链路。

- [ ] 3.1 选股工作台：选择 2-3 种策略，执行选股，确认返回结果
- [ ] 3.2 选股工作台：查看股票详情（K 线图、AI 分析）
- [ ] 3.3 回测中心：新建回测（选 1 只股票，近 1 年数据）
- [ ] 3.4 回测中心：查看回测结果（绩效指标、收益曲线、交易明细）
- [ ] 3.5 回测中心：确认回测列表分页正常
- [ ] 3.6 验证 Redis 缓存生效（第二次选股应更快）
- [ ] 3.7 验证 Redis 不可用时自动降级（停掉 Redis 后选股仍可用）

## Phase 4: 回测准确性验证 [P1]

> 确保回测结果可信。

- [ ] 4.1 选一只已知走势的股票（如 600519 贵州茅台），手动计算预期收益，对比回测结果
- [ ] 4.2 验证佣金计算：检查交易明细中的 commission 是否符合万 2.5 + 印花税千 1
- [ ] 4.3 验证涨跌停限制：构造涨停/跌停场景，确认买卖被正确拦截
- [ ] 4.4 验证前复权：对比有除权的股票，确认价格连续性

## Phase 5: 定时任务验证 [P2]

> 确认盘后自动化链路。

- [ ] 5.1 手动触发调度器：`uv run python -m app.scheduler`
- [ ] 5.2 确认任务链路：数据同步 → 指标计算 → 缓存刷新 → 策略筛选
- [ ] 5.3 检查日志输出是否正常

---

## V2 规划（后续版本）

| 功能 | 价值 | 复杂度 | 建议优先级 |
|------|------|--------|-----------|
| 参数优化模块 | 高 — 自动寻找最优策略参数 | 中 | V2-P0 |
| 更多选股策略 | 中 — 扩充策略库到 20+ | 低 | V2-P0 |
| AI 多模型降级 | 中 — 提升 AI 分析可用性 | 中 | V2-P1 |
| 新闻舆情监控 | 中 — 辅助投资决策 | 高 | V2-P2 |
| 实时监控告警 | 低 — 个人用户需求不强 | 高 | V2-P3 |
| 高手跟投 | 低 — 数据源难获取 | 高 | V2-P3 |

---

## 建议执行顺序

```
Phase 1 (环境+数据) → Phase 2 (冒烟测试) → Phase 3 (业务验收) → Phase 4 (回测验证) → Phase 5 (定时任务)
```

**最先做 Phase 1**，因为所有后续步骤都依赖真实数据。预计 Phase 1-2 可在 1 次会话内完成。
