# ===========================================
# A股智能选股系统 - 环境变量配置
# 复制此文件为 .env 并填入实际值
# 多环境支持：APP_ENV_FILE=.env.prod 指定配置文件
# ===========================================

# --- 应用 ---
APP_ENV=development
LOG_LEVEL=INFO
PERFORMANCE_LOG_LEVEL=INFO          # 性能日志级别：DEBUG（详细）/INFO（默认）/WARNING（仅慢速操作）

# --- 数据库 (PostgreSQL) ---
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/stock_selector
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_ECHO=false

# --- Redis ---
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# --- BaoStock 数据源 ---
BAOSTOCK_RETRY_COUNT=3
BAOSTOCK_RETRY_INTERVAL=2.0
BAOSTOCK_TIMEOUT=30
BAOSTOCK_QPS_LIMIT=5
BAOSTOCK_POOL_SIZE=5                # 连接池大小（最大并发连接数）
BAOSTOCK_POOL_TIMEOUT=30.0          # 获取连接的超时时间（秒）
BAOSTOCK_SESSION_TTL=3600.0         # 会话生存时间（秒），超时后重新 login

# --- AKShare 数据源 ---
AKSHARE_RETRY_COUNT=3
AKSHARE_RETRY_INTERVAL=1.0
AKSHARE_TIMEOUT=20
AKSHARE_QPS_LIMIT=10

# --- ETL ---
ETL_BATCH_SIZE=5000
ETL_COMMIT_INTERVAL=10

# --- Daily Sync (批量同步) ---
DAILY_SYNC_BATCH_SIZE=100           # 批量同步每批股票数
DAILY_SYNC_CONCURRENCY=10           # 批量同步并发数

# --- Data Integrity Check (数据完整性检查) ---
DATA_INTEGRITY_CHECK_ENABLED=true   # 启动时是否检查数据完整性（断点续传）
DATA_INTEGRITY_CHECK_DAYS=30        # 检查最近 N 天的数据完整性

# --- Auto Data Update (自动数据更新) ---
AUTO_UPDATE_ENABLED=true                                                        # 是否启用自动数据更新
AUTO_UPDATE_PROBE_INTERVAL=15                                                   # 嗅探间隔（分钟）
AUTO_UPDATE_PROBE_TIMEOUT=18:00                                                 # 嗅探超时时间
AUTO_UPDATE_PROBE_STOCKS=["600519.SH","000001.SZ","600036.SH","000858.SZ","601318.SH"]  # 嗅探样本股票
AUTO_UPDATE_PROBE_THRESHOLD=0.8                                                 # 嗅探成功阈值（80%样本有数据）
SCHEDULER_AUTO_UPDATE_CRON=30 15 * * 1-5                                       # 自动更新任务触发时间（周一至周五 15:30）

# --- Sync Progress (累积进度追踪) ---
DATA_START_DATE=2024-01-01              # 历史数据起始日期（新股首次同步从此日期开始）
SYNC_STOCK_LIST_ON_STARTUP=true         # 启动时是否自动更新股票列表
BATCH_SYNC_MAX_RETRIES=3                # 失败股票最大重试次数
DATA_COMPLETENESS_THRESHOLD=0.95        # 数据完成率阈值（低于此值跳过策略计算）
SYNC_BATCH_DAYS=365                     # 批量同步每批天数
SYNC_BATCH_TIMEOUT=14400                # 批量同步整体超时（秒，默认 4 小时）
SYNC_FAILURE_RETRY_CRON=0 20 * * 1-5   # 失败重试定时任务（周一至周五 20:00）
PIPELINE_COMPLETENESS_DEADLINE=18:00    # 完整性告警截止时间

# --- AI (V1 只用 Gemini) ---
GEMINI_API_KEY=your-gemini-api-key-here
GEMINI_USE_ADC=false                # 使用 Google ADC 认证（与 API Key 二选一，需先 gcloud auth application-default login）
GEMINI_GCP_PROJECT=                 # GCP 项目 ID（ADC 模式必填）
GEMINI_GCP_LOCATION=us-central1     # GCP 区域（ADC 模式）
GEMINI_MODEL_ID=gemini-2.0-flash
GEMINI_MAX_TOKENS=4000
GEMINI_TIMEOUT=30
GEMINI_MAX_RETRIES=2
AI_DAILY_BUDGET_USD=1.0

# --- Cache (Redis) ---
CACHE_TECH_TTL=90000
CACHE_PIPELINE_RESULT_TTL=172800
CACHE_WARMUP_ON_STARTUP=true
CACHE_REFRESH_BATCH_SIZE=500

# --- CORS ---
CORS_ORIGINS=["http://localhost:5173"]

# --- 数据源 Token (V2) ---
TUSHARE_TOKEN=your-tushare-token-here
