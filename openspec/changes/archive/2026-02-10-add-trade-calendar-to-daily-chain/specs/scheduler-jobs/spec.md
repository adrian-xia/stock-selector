## MODIFIED Requirements

### Requirement: 盘后链路执行步骤

系统 SHALL 在盘后链路中添加交易日历更新步骤，确保交易日历数据保持最新。

#### Scenario: 交易日历更新作为第一步

- **WHEN** 盘后链路开始执行
- **THEN** 首先执行交易日历更新步骤
- **AND** 更新未来 90 天的交易日历数据
- **AND** 记录性能日志（更新耗时）

#### Scenario: 交易日历更新成功

- **WHEN** 交易日历更新成功
- **THEN** 记录 INFO 级别日志
- **AND** 日志包含更新的日期范围和记录数
- **AND** 继续执行后续步骤（交易日校验、日线同步等）

#### Scenario: 交易日历更新失败

- **WHEN** 交易日历更新失败
- **THEN** 记录 WARNING 级别日志
- **AND** 日志包含错误信息
- **AND** 继续执行后续步骤（不阻断链路）

#### Scenario: 盘后链路完整步骤顺序

- **WHEN** 盘后链路执行
- **THEN** 按以下顺序执行步骤：
  1. 交易日历更新（新增）
  2. 交易日校验
  3. 日线数据同步
  4. 技术指标计算
  5. 缓存刷新
  6. 策略管道执行

### Requirement: 周末任务保留交易日历更新

系统 SHALL 在周末任务中保留交易日历更新步骤，作为兜底机制。

#### Scenario: 周末任务更新交易日历

- **WHEN** 周末任务（`sync_stock_list_job`）执行
- **THEN** 首先执行交易日历更新
- **AND** 然后执行股票列表同步
- **AND** 交易日历更新失败不阻断股票列表同步

#### Scenario: 周末任务与每日任务的交易日历更新不冲突

- **WHEN** 周末任务和每日任务都更新交易日历
- **THEN** 使用 UPSERT 逻辑避免重复数据
- **AND** 不产生数据冲突或错误
