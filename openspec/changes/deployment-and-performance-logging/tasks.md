## 1. 打包脚本实现

- [ ] 1.1 创建 `scripts/package.py` 脚本文件
- [ ] 1.2 实现版本号获取逻辑（git tag 或 commit hash）
- [ ] 1.3 实现文件收集逻辑（源代码、uv.lock、.env.example、README）
- [ ] 1.4 实现包内容验证（检查必需文件是否存在）
- [ ] 1.5 实现 tarball 打包逻辑（创建 dist/stock-selector-<version>.tar.gz）
- [ ] 1.6 添加打包日志输出（显示打包进度和结果）
- [ ] 1.7 测试打包脚本（验证生成的包可以正常解压和运行）

## 2. 服务管理脚本实现

- [ ] 2.1 创建 `scripts/service.py` 主脚本（统一接口）
- [ ] 2.2 实现平台检测逻辑（识别 Linux/Mac/Windows）
- [ ] 2.3 实现 Linux systemd 服务管理（install/uninstall/start/stop/status）
- [ ] 2.4 创建 systemd 服务文件模板（stock-selector.service）
- [ ] 2.5 实现 Mac launchd 服务管理（install/uninstall/start/stop/status）
- [ ] 2.6 创建 launchd plist 文件模板（com.stock-selector.plist）
- [ ] 2.7 实现 Windows 服务管理（install/uninstall/start/stop/status）
- [ ] 2.8 添加 pywin32 为可选依赖（仅 Windows 平台）
- [ ] 2.9 实现前台启动模式（--foreground 参数）
- [ ] 2.10 实现优雅关闭逻辑（等待任务完成，超时强制停止）
- [ ] 2.11 添加服务日志配置（后台模式写入日志文件）
- [ ] 2.12 测试服务管理脚本（在 Linux/Mac 上测试安装、启动、停止）

## 3. 数据完整性检查实现

- [ ] 3.1 在 `app/data/manager.py` 添加 `detect_missing_dates()` 方法
- [ ] 3.2 实现交易日查询逻辑（查询指定日期范围的交易日）
- [ ] 3.3 实现已有数据查询逻辑（查询数据库中已有数据的日期）
- [ ] 3.4 实现缺失日期计算逻辑（交易日 - 已有日期）
- [ ] 3.5 在 `app/scheduler/core.py` 添加启动时数据完整性检查
- [ ] 3.6 实现检查逻辑（检查最近 30 天，可配置）
- [ ] 3.7 实现自动补齐逻辑（调用 batch_sync_daily 补齐缺失数据）
- [ ] 3.8 添加 `--skip-integrity-check` 启动参数（跳过检查）
- [ ] 3.9 添加配置项 `DATA_INTEGRITY_CHECK_DAYS`（检查窗口，默认 30）
- [ ] 3.10 测试启动时检查（模拟缺失数据场景）

## 4. 手动数据补齐命令

- [ ] 4.1 在 `app/data/cli.py` 添加 `backfill-daily` 命令
- [ ] 4.2 实现日期范围参数解析（--start, --end）
- [ ] 4.3 实现交易日过滤逻辑（只补齐交易日）
- [ ] 4.4 实现已有数据检查逻辑（跳过已有数据的日期）
- [ ] 4.5 实现批量补齐逻辑（调用 batch_sync_daily）
- [ ] 4.6 添加进度日志（显示补齐进度）
- [ ] 4.7 添加 `--rate-limit` 参数（降低补齐速度，避免限流）
- [ ] 4.8 测试补齐命令（验证跳过已有数据、只补齐缺失数据）

## 5. 数据初始化向导

- [ ] 5.1 创建 `scripts/init_data.py` 初始化向导脚本
- [ ] 5.2 实现数据库状态检测（检查是否已有数据）
- [ ] 5.3 实现交互式选项（1 年 / 3 年 / 自定义范围）
- [ ] 5.4 实现初始化流程（股票列表 → 日线数据 → 复权因子 → 技术指标）
- [ ] 5.5 添加进度显示（每个步骤的进度和预计剩余时间）
- [ ] 5.6 添加确认提示（数据库已有数据时提示是否继续）
- [ ] 5.7 测试初始化向导（验证完整的初始化流程）

## 6. 批量同步性能日志增强

- [x] 6.1 在 `app/data/batch.py` 添加批次进度日志
- [x] 6.2 添加每批次耗时日志（批次号、成功数、失败数、耗时）
- [x] 6.3 添加慢速股票检测和日志（耗时 >5 秒的股票）
- [x] 6.4 添加失败股票详细日志（股票代码 + 失败原因）
- [x] 6.5 添加总体汇总日志（总成功数、总失败数、总耗时、平均耗时）
- [x] 6.6 在 `app/data/manager.py` 的 `sync_daily()` 添加细粒度日志（API 调用、数据清洗、数据库写入分步计时）
- [ ] 6.7 测试批量同步日志（验证日志格式和内容）

## 7. 技术指标计算性能日志

- [ ] 7.1 在 `app/data/indicator.py` 添加每个指标的计算耗时日志
- [ ] 7.2 添加指标计算总体汇总日志（总指标数、总耗时）
- [ ] 7.3 添加慢速指标检测和日志（耗时 >30 秒的指标）
- [ ] 7.4 测试指标计算日志（验证日志格式和内容）

## 8. 缓存刷新性能日志

- [ ] 8.1 在 `app/cache/tech_cache.py` 添加缓存刷新进度日志
- [ ] 8.2 添加缓存命中率统计和日志
- [ ] 8.3 添加缓存刷新总体汇总日志（总股票数、命中率、总耗时）
- [ ] 8.4 添加慢速缓存操作检测和日志（耗时 >5 秒的操作）
- [ ] 8.5 测试缓存刷新日志（验证日志格式和内容）

## 9. 调度器任务性能日志

- [ ] 9.1 在 `app/scheduler/jobs.py` 的 `sync_daily_step` 添加详细日志
- [ ] 9.2 在 `app/scheduler/jobs.py` 的 `indicator_step` 添加详细日志
- [ ] 9.3 在 `app/scheduler/jobs.py` 的 `cache_refresh_step` 添加详细日志
- [ ] 9.4 在 `run_post_market_chain` 添加总体耗时日志（包含分钟格式）
- [ ] 9.5 测试调度器任务日志（验证日志格式和内容）

## 10. 性能日志配置

- [ ] 10.1 在 `app/config.py` 添加 `PERFORMANCE_LOG_LEVEL` 配置项
- [ ] 10.2 在 `.env.example` 添加性能日志配置说明
- [ ] 10.3 实现日志级别控制逻辑（DEBUG/INFO/WARNING）
- [ ] 10.4 测试不同日志级别（验证日志输出符合预期）

## 11. PROJECT_TASKS.md 更新

- [ ] 11.1 在 `PROJECT_TASKS.md` 新增"性能优化"章节
- [ ] 11.2 添加性能瓶颈跟踪模板（问题描述、影响、优化方案、状态）
- [ ] 11.3 添加当前已知的性能问题（如有）

## 12. 文档更新

- [ ] 12.1 更新 `README.md` 添加部署章节（打包、安装、配置、启动）
- [ ] 12.2 更新 `README.md` 添加服务管理章节（安装服务、启动、停止、状态查询）
- [ ] 12.3 更新 `README.md` 添加数据初始化章节（初始化向导、手动补齐）
- [ ] 12.4 更新 `.env.example` 添加新配置项（DATA_INTEGRITY_CHECK_DAYS, PERFORMANCE_LOG_LEVEL）
- [ ] 12.5 更新 `CLAUDE.md` 补充部署和运维相关说明
- [ ] 12.6 更新设计文档（`~/Developer/Design/stock-selector-design/`）补充部署架构

## 13. 测试和验证

- [ ] 13.1 测试打包流程（打包 → 解压 → 安装依赖 → 运行）
- [ ] 13.2 测试服务管理（安装 → 启动 → 停止 → 卸载）
- [ ] 13.3 测试数据完整性检查（启动时检查、自动补齐）
- [ ] 13.4 测试手动补齐命令（指定日期范围、跳过已有数据）
- [ ] 13.5 测试初始化向导（首次部署场景）
- [ ] 13.6 测试性能日志（验证日志输出完整、格式正确）
- [ ] 13.7 测试不同日志级别（DEBUG/INFO/WARNING）
- [ ] 13.8 在 Linux 环境测试完整部署流程
- [ ] 13.9 在 Mac 环境测试完整部署流程（如有条件）
- [ ] 13.10 验证日志文件大小和轮转（确保不会快速增长）
